name: بث مباشر RTMP دائم

on:
  workflow_dispatch:

jobs:
  live-stream:
    runs-on: ubuntu-latest

    container:
      image: jrottenberg/ffmpeg:6.0-ubuntu  # Docker image فيه FFmpeg جاهز

    steps:
      - name: بدء البث المستمر
        run: |
          INPUT="https://ab.footballii.ir/hls2/bein1_src.m3u8"
          OUTPUT="rtmp://vsu.okcdn.ru/input/10237855538790_8860754578022_h5fia4qh44"

          while true; do
            echo "==============================="
            echo "بدء محاولة بث جديدة في $(date -u)"
            echo "==============================="

            ffmpeg -re \
              -user_agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" \
              -fflags +genpts -rtbufsize 100M -timeout 5000000 \
              -reconnect 1 -reconnect_at_eof 1 -reconnect_streamed 1 -reconnect_delay_max 5 \
              -i "$INPUT" \
              -c:v copy -c:a copy -f flv "$OUTPUT" \
              -loglevel error \
              -hide_banner \
              -stats

            echo "حدث خطأ أو انتهى البث، إعادة المحاولة بعد 10 ثواني..."
            sleep 10
          done
